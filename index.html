<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Fullscreen Iframe + Close Countdown Overlay</title>

  <style>
    :root{
      --blur-amount: 4px;
      --btn-radius: 999px;
      --btn-bg: rgba(10,10,12,.85);
      --btn-border: rgba(255,255,255,.25);
      --btn-shadow: 0 14px 40px rgba(0,0,0,.45);
    }

    html, body{
      height:100%;
      margin:0;
      padding:0;
      overflow:hidden;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background:#000;
    }

    .fs-iframe{
      position: fixed;
      inset: 0;
      width: 100vw;
      height: 100vh;
      border: 0;
      display:block;
      background:#000;
      z-index: 1;
    }

    .blur-layer{
      position: fixed;
      inset: 0;
      z-index: 2;
      background: rgba(0,0,0,.18);
      backdrop-filter: blur(var(--blur-amount));
      -webkit-backdrop-filter: blur(var(--blur-amount));
      pointer-events: none;
    }

    .close-wrap{
      position: fixed;
      inset: 0;
      z-index: 3;
      display:grid;
      place-items:center;
    }

    .close-btn{
      appearance: none;
      border: 1px solid var(--btn-border);
      background: var(--btn-bg);
      color:#fff;
      padding: 14px 22px;
      font-size: 15px;
      font-weight: 700;
      border-radius: var(--btn-radius);
      box-shadow: var(--btn-shadow);
      cursor: not-allowed;
      opacity: .65;
      transition: .15s ease;
      text-align:center;
      min-width: 160px;
    }
    .close-btn.enabled{
      cursor: pointer;
      opacity: 1;
    }
    .close-btn.enabled:hover{
      transform: translateY(-1px);
      background: rgba(20,20,24,.95);
    }

    @supports(padding: max(0px)){
      .close-wrap{
        padding-bottom: env(safe-area-inset-bottom);
      }
    }

    /* baru: untuk sembunyikan elemen sebelum klik pertama */
    .hidden{
      display: none !important;
    }
  </style>
</head>

<body>
  <!-- iframe disembunyikan dulu -->
  <iframe
    id="main-iframe"
    class="fs-iframe hidden"
    src="https://taxdifferenceinvestor.com/rigxzxmw4?key=1083746753524088ad6b003868517a0e"
    title="Main Iframe"
    loading="eager"
    referrerpolicy="no-referrer-when-downgrade"
    allow="autoplay; fullscreen"
  ></iframe>

  <!-- blur & overlay juga disembunyikan dulu -->
  <div class="blur-layer hidden" aria-hidden="true"></div>

  <div class="close-wrap hidden" role="dialog" aria-modal="true" aria-label="Close overlay">
    <button id="close-btn" class="close-btn" type="button" disabled>
      Tutup (3)
    </button>
  </div>

  <script>
    (() => {
      const iframe   = document.getElementById("main-iframe");
      const blur     = document.querySelector(".blur-layer");
      const closeWrap= document.querySelector(".close-wrap");
      const closeBtn = document.getElementById("close-btn");

      const delayMs = 1000;

      function startOverlay(){
        // munculkan elemen-elemen overlay
        iframe.classList.remove("hidden");
        blur.classList.remove("hidden");
        closeWrap.classList.remove("hidden");

        // mulai countdown
        let t = 3;
        closeBtn.disabled = true;
        closeBtn.classList.remove("enabled");
        closeBtn.textContent = `Tutup (${t})`;

        const timer = setInterval(() => {
          t -= 1;
          if (t > 0) {
            closeBtn.textContent = `Tutup (${t})`;
          } else {
            clearInterval(timer);
            closeBtn.disabled = false;
            closeBtn.classList.add("enabled");
            closeBtn.textContent = "Tutup";
          }
        }, 700);

        // handler klik tombol tutup
        closeBtn.addEventListener("click", () => {
          if (closeBtn.disabled) return;

          closeBtn.disabled = true;      // optional: biar gak spam klik
          closeBtn.textContent = "Wait..";

          setTimeout(() => {
            if (window.history.length > 1) {
              window.close();
            } else {
              window.location.href = "#";
            }
          }, delayMs);
        });

        // ESC untuk tutup (kalau sudah aktif)
        document.addEventListener("keydown", (e) => {
          if (e.key === "Escape" && !closeBtn.disabled) closeBtn.click();
        });
      }

      // iframe + overlay baru muncul saat KLIK PERTAMA di dokumen
      document.addEventListener(
        "click",
        () => {
          startOverlay();
        },
        { once: true } // pastikan cuma sekali
      );
    })();
  </script>
</body>
</html>
